!function(e){e.fn.richText=function(t){function a(e,t){void 0===t&&(t=null),o(),"heading"===e&&l()?d("<"+t+">"+l()+"</"+t+">"):document.execCommand(e,!1,t)}function n(){var t=e("#"+q),a=t.html();t.siblings(".richText-initial").val(a)}function i(){var t=e("#"+q),a=t.siblings(".richText-initial").val();t.html(a)}function l(){return window.getSelection?window.getSelection().toString():!!document.selection.createRange&&document.selection.createRange().text}function r(){u=m()}function o(){u&&h()}function d(e){var t,a;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(a=t.getRangeAt(0)).deleteContents();var n=document.createElement("div");n.innerHTML=e;for(var i,l,r=document.createDocumentFragment();i=n.firstChild;)l=r.appendChild(i);a.insertNode(r),l&&((a=a.cloneRange()).setStartAfter(l),a.collapse(!0),t.removeAllRanges(),t.addRange(a))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(e)}function c(){f.find(".richText-editor").is(":visible")?(f.find(".richText-initial").show(),f.find(".richText-editor").hide(),e(".richText-toolbar").find(".richText-btn").each(function(){e(this).hasClass("fa-code")||e(this).parent("li").attr("data-disable","true")})):(f.find(".richText-initial").hide(),f.find(".richText-editor").show(),e(".richText-toolbar").find("li").removeAttr("data-disable"))}var p=e.extend({bold:!0,italic:!0,underline:!0,leftAlign:!0,centerAlign:!0,rightAlign:!0,ol:!0,ul:!0,heading:!0,fontColor:!0,imageUpload:!0,fileUpload:!0,urls:!0,table:!0,removeStyles:!0,code:!0,colors:[],fileHTML:"",imageHTML:""},t),s=e(this);s.addClass("richText-initial");var f,m,h,u,x=e("<ul />"),g=e("<li />"),v=e("<a />",{class:"richText-btn fa fa-bold","data-command":"bold"}),T=e("<a />",{class:"richText-btn fa fa-italic","data-command":"italic"}),b=e("<a />",{class:"richText-btn fa fa-underline","data-command":"underline"}),R=e("<a />",{class:"richText-btn fa fa-align-left","data-command":"justifyLeft"}),w=e("<a />",{class:"richText-btn fa fa-align-center","data-command":"justifyCenter"}),y=e("<a />",{class:"richText-btn fa fa-align-right","data-command":"justifyRight"}),C=e("<a />",{class:"richText-btn fa fa-list-ol","data-command":"insertOrderedList"}),L=e("<a />",{class:"richText-btn fa fa-list","data-command":"insertUnorderedList"}),k=e("<a />",{class:"richText-btn fa fa-header"}),U=e("<a />",{class:"richText-btn fa fa-paint-brush"}),F=e("<a />",{class:"richText-btn fa fa-image"}),S=e("<a />",{class:"richText-btn fa fa-file-text-o"}),A=e("<a />",{class:"richText-btn fa fa-link"}),B=e("<a />",{class:"richText-btn fa fa-table"}),D=e("<a />",{class:"richText-btn fa fa-recycle","data-command":"removeFormat"}),E=e("<a />",{class:"richText-btn fa fa-code","data-command":"toggleCode"}),M=e("<div />",{class:"richText-dropdown-outer"}),H=e("<ul />",{class:"richText-dropdown"}),I=e("<div />",{class:"richText-dropdown"}),N=e("<div />",{class:"richText-form"}),P=e("<div />",{class:"richText-form-item"}),W=e("<label />"),j=e("<input />",{type:"text"}),O=(e("<input />",{type:"file"}),e("<select />")),_=e("<button />",{text:"Einf√ºgen",class:"btn"}),q="richText-"+Math.random().toString(36).substring(7),G=H.clone();G.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h1">Title #1</a>'})),G.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h2">Title #2</a>'})),G.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h3">Title #3</a>'})),G.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h4">Title #4</a>'})),k.append(M.clone().append(G));var Q=H.clone();Q.html(function(e){var t=[],a="";t["#FFFFFF"]="White",t["#000000"]="Black",t["#7F6000"]="Brown",t["#938953"]="Beige",t["#1F497D"]="Dark Blue",t.blue="Blue",t["#4F81BD"]="Light blue",t["#953734"]="Dark red",t.red="Red",t["#4F6128"]="Dark green",t.green="Green",t["#3F3151"]="Purple",t["#31859B"]="Dark Turquois",t["#4BACC6"]="Turquois",t["#E36C09"]="Dark orange",t["#F79646"]="Orange",t["#FFFF00"]="Yellow",p.colors&&p.colors.length>0&&(t=p.colors);for(var n in t)a+='<li class="inline"><a data-command="'+e+'" data-option="'+n+'" style="text-align:left;" title="'+t[n]+'"><span class="box-color" style="background-color:'+n+'"></span></a></li>';return a}("forecolor")),U.append(M.clone().append(Q));var X=I.clone(),Y=N.clone().attr("id","richText-URL").attr("data-editor",q);Y.append(P.clone().append(W.clone().text("URL").attr("for","url")).append(j.clone().attr("id","url"))),Y.append(P.clone().append(W.clone().text("Text").attr("for","urlText")).append(j.clone().attr("id","urlText"))),Y.append(P.clone().append(W.clone().text("Open in").attr("for","openIn")).append(O.clone().attr("id","openIn").append(e("<option />",{value:"_self",text:"Same tab"})).append(e("<option />",{value:"_blank",text:"New tab"})))),Y.append(P.clone().append(_.clone())),X.append(Y),A.append(M.clone().append(X));var $=I.clone(),z=N.clone().attr("id","richText-Image").attr("data-editor",q);p.imageHTML&&(e(p.imageHTML).find("#imageURL").length>0||"imageURL"===e(p.imageHTML).attr("id"))?z.html(p.imageHTML):(z.append(P.clone().append(W.clone().text("Image URL").attr("for","imageURL")).append(j.clone().attr("id","imageURL"))),z.append(P.clone().append(W.clone().text("Align").attr("for","align")).append(O.clone().attr("id","align").append(e("<option />",{value:"left",text:"Left"})).append(e("<option />",{value:"center",text:"Center"})).append(e("<option />",{value:"right",text:"Right"}))))),z.append(P.clone().append(_.clone())),$.append(z),F.append(M.clone().append($));var J=I.clone(),K=N.clone().attr("id","richText-File").attr("data-editor",q);p.fileHTML&&(e(p.fileHTML).find("#fileURL").length>0||"fileURL"===e(p.fileHTML).attr("id"))?K.html(p.fileHTML):(K.append(P.clone().append(W.clone().text("File URL").attr("for","fileURL")).append(j.clone().attr("id","fileURL"))),K.append(P.clone().append(W.clone().text("Link text").attr("for","fileText")).append(j.clone().attr("id","fileText")))),K.append(P.clone().append(_.clone())),J.append(K),S.append(M.clone().append(J));var V=I.clone(),Z=N.clone().attr("id","richText-Table").attr("data-editor",q);Z.append(P.clone().append(W.clone().text("Rows").attr("for","tableRows")).append(j.clone().attr("id","tableRows").attr("type","number"))),Z.append(P.clone().append(W.clone().text("Columns").attr("for","tableColumns")).append(j.clone().attr("id","tableColumns").attr("type","number"))),Z.append(P.clone().append(_.clone())),V.append(Z),B.append(M.clone().append(V));return function(){var t,a,n="";"TEXTAREA"===s.prop("tagName")||(s.val()?(t=s.val(),a=s.prop("attributes"),e.each(a,function(){this.name&&(n+=" "+this.name+'="'+this.value+'"')}),s.replaceWith(e("<textarea"+n+' data-richtext="init">'+t+"</textarea>")),(s=e('[data-richtext="init"]')).removeAttr("data-richtext")):s.html()?(t=s.html(),a=s.prop("attributes"),e.each(a,function(){this.name&&(n+=" "+this.name+'="'+this.value+'"')}),s.replaceWith(e("<textarea"+n+' data-richtext="init">'+t+"</textarea>")),(s=e('[data-richtext="init"]')).removeAttr("data-richtext")):(a=s.prop("attributes"),e.each(a,function(){this.name&&(n+=" "+this.name+'="'+this.value+'"')}),s.replaceWith(e("<textarea"+n+' data-richtext="init"></textarea>')),(s=e('[data-richtext="init"]')).removeAttr("data-richtext"))),f=e("<div />",{class:"richText"});var i=e("<div />",{class:"richText-toolbar"}),l=e("<div />",{class:"richText-editor",id:q,contenteditable:!0});i.append(x),!0===p.bold&&x.append(g.clone().append(v)),!0===p.italic&&x.append(g.clone().append(T)),!0===p.underline&&x.append(g.clone().append(b)),!0===p.leftAlign&&x.append(g.clone().append(R)),!0===p.centerAlign&&x.append(g.clone().append(w)),!0===p.rightAlign&&x.append(g.clone().append(y)),!0===p.ol&&x.append(g.clone().append(C)),!0===p.ul&&x.append(g.clone().append(L)),!0===p.heading&&x.append(g.clone().append(k)),!0===p.fontColor&&x.append(g.clone().append(U)),!0===p.imageUpload&&x.append(g.clone().append(F)),!0===p.fileUpload&&x.append(g.clone().append(S)),!0===p.urls&&x.append(g.clone().append(A)),!0===p.table&&x.append(g.clone().append(B)),!0===p.removeStyles&&x.append(g.clone().append(D)),!0===p.code&&x.append(g.clone().append(E)),l.html(s.val()),f.append(i),f.append(l),f.append(s.clone().hide()),s.replaceWith(f)}(),e(document).on("keyup keydown change blur paste copy cut",".richText-editor",function(){n(),r()}),e(document).on("keyup keydown blur paste copy cut",".richText-initial",function(){i(),r()}),e(document).on("click","#richText-URL button.btn",function(t){t.preventDefault();var a=e(this).parent(".richText-form-item").parent(".richText-form");if(a.attr("data-editor")===q){var n=a.find("input#url").val(),i=a.find("input#urlText").val(),l=a.find("#openIn").val();if(l||(l="_self"),i||(i=n),n){var r='<a href="'+n+'" target="'+l+'">'+i+"</a>";h(),d(r),a.find("input#url").val(""),a.find("input#urlText").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}else a.prepend(e("<div />",{style:"color:red;display:none;",class:"form-item is-error",text:"Please enter an URL"})),a.children(".form-item.is-error").slideDown(),setTimeout(function(){a.children(".form-item.is-error").slideUp(function(){e(this).remove()})},5e3)}}),e(document).on("click","#richText-Image button.btn",function(t){t.preventDefault();var a=e(this).parent(".richText-form-item").parent(".richText-form");if(a.attr("data-editor")===q){var n=a.find("#imageURL").val(),i=a.find("select#align").val();if(i||(i="center"),n){var l="";l="center"===i?'<div style="text-align:center;"><img src="'+n+'"></div>':'<img src="'+n+'" align="'+i+'">',h(),d(l),a.find("input#imageURL").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}else a.prepend(e("<div />",{style:"color:red;display:none;",class:"form-item is-error",text:"Please select an image."})),a.children(".form-item.is-error").slideDown(),setTimeout(function(){a.children(".form-item.is-error").slideUp(function(){e(this).remove()})},5e3)}}),e(document).on("click","#richText-File button.btn",function(t){t.preventDefault();var a=e(this).parent(".richText-form-item").parent(".richText-form");if(a.attr("data-editor")===q){var n=a.find("#fileURL").val(),i=a.find("#fileText").val();if(i||(i=n),n){var l='<a href="'+n+'" target="_blank">'+i+"</a>";h(),d(l),a.find("input#fileURL").val(""),a.find("input#fileText").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}else a.prepend(e("<div />",{style:"color:red;display:none;",class:"form-item is-error",text:"Please select a file."})),a.children(".form-item.is-error").slideDown(),setTimeout(function(){a.children(".form-item.is-error").slideUp(function(){e(this).remove()})},5e3)}}),e(document).on("click","#richText-Table button.btn",function(t){t.preventDefault();var a=e(this).parent(".richText-form-item").parent(".richText-form");if(a.attr("data-editor")===q){var n=a.find("input#tableRows").val(),i=a.find("input#tableColumns").val();(!n||n<=0)&&(n=2),(!i||i<=0)&&(i=2);for(var l='<table class="table-1"><tbody>',r=1;r<=n;r++){l+="<tr>";for(var o=1;o<=i;o++)l+="<td> </td>";l+="</tr>"}l+="</tbod></table>",h(),d(l),a.find("input#tableColumns").val(""),a.find("input#tableRows").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}}),e(document).on("click",function(t){var a=e(t.target);if(0===a.parents(".richText-toolbar").length);else if(a.hasClass("richText-dropdown-outer"))a.parent("a").parent("li").removeClass("is-selected");else if(a.find(".richText").length>0)e(".richText-toolbar li").removeClass("is-selected");else if(a.hasClass("richText-btn")&&e(t.target).children(".richText-dropdown-outer").length>0)if(a.parent("li").addClass("is-selected"),a.hasClass("fa-link")){h();var n=l();a.find("input#urlText").val(""),a.find("input#url").val(""),n&&a.find("input#urlText").val(n)}else a.hasClass("fa-image")}),e(document).on("click",".richText-toolbar a[data-command]",function(t){var n=e(this);if(n.closest(".richText-toolbar").siblings("#"+q).length>0&&(!n.parent("li").attr("data-disable")||"false"===n.parent("li").attr("data-disable"))){t.preventDefault();var i=e(this).data("command");if("toggleCode"===i)c();else{var l=null;e(this).data("option")&&(l=e(this).data("option")).match(/^h[1-6]$/)&&(i="heading"),a(i,l),"removeFormat"===i&&a("formatBlock","div")}}}),window.getSelection&&document.createRange?(m=function(){var e=document.getElementById(q),t=window.getSelection&&window.getSelection();if(t&&t.rangeCount>0){var a=window.getSelection().getRangeAt(0),n=a.cloneRange();n.selectNodeContents(e),n.setEnd(a.startContainer,a.startOffset);var i=n.toString().length;return{start:i,end:i+a.toString().length}}return{start:0,end:0}},h=function(){var e=document.getElementById(q),t=u,a=0,n=document.createRange();n.setStart(e,0),n.collapse(!0);for(var i,l=[e],r=!1,o=!1;!o&&(i=l.pop());)if(3===i.nodeType){var d=a+i.length;!r&&t.start>=a&&t.start<=d&&(n.setStart(i,t.start-a),r=!0),r&&t.end>=a&&t.end<=d&&(n.setEnd(i,t.end-a),o=!0),a=d}else for(var c=i.childNodes.length;c--;)l.push(i.childNodes[c]);var p=window.getSelection();p.removeAllRanges(),p.addRange(n)}):document.selection&&document.body.createTextRange&&(m=function(){var e=document.getElementById(q),t=document.selection.createRange(),a=document.body.createTextRange();a.moveToElementText(e),a.setEndPoint("EndToStart",t);var n=a.text.length;return{start:n,end:n+t.text.length}},h=function(){var e=document.getElementById(q),t=u,a=document.body.createTextRange();a.moveToElementText(e),a.collapse(!0),a.moveEnd("character",t.end),a.moveStart("character",t.start),a.select()}),e(this)}}(jQuery);
